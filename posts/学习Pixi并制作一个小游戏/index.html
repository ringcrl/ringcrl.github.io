<!DOCTYPE html><html lang="zh-CN" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="学习Pixi并制作一个小游戏" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="学习用 PixiJS 制作游戏和互动媒体。" /><meta property="og:description" content="学习用 PixiJS 制作游戏和互动媒体。" /><link rel="canonical" href="chenng.cn/posts/%E5%AD%A6%E4%B9%A0Pixi%E5%B9%B6%E5%88%B6%E4%BD%9C%E4%B8%80%E4%B8%AA%E5%B0%8F%E6%B8%B8%E6%88%8F/" /><meta property="og:url" content="chenng.cn/posts/%E5%AD%A6%E4%B9%A0Pixi%E5%B9%B6%E5%88%B6%E4%BD%9C%E4%B8%80%E4%B8%AA%E5%B0%8F%E6%B8%B8%E6%88%8F/" /><meta property="og:site_name" content="Chenng’s Home" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2017-12-16T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="学习Pixi并制作一个小游戏" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2017-12-16T00:00:00+08:00","datePublished":"2017-12-16T00:00:00+08:00","description":"学习用 PixiJS 制作游戏和互动媒体。","headline":"学习Pixi并制作一个小游戏","mainEntityOfPage":{"@type":"WebPage","@id":"chenng.cn/posts/%E5%AD%A6%E4%B9%A0Pixi%E5%B9%B6%E5%88%B6%E4%BD%9C%E4%B8%80%E4%B8%AA%E5%B0%8F%E6%B8%B8%E6%88%8F/"},"url":"chenng.cn/posts/%E5%AD%A6%E4%B9%A0Pixi%E5%B9%B6%E5%88%B6%E4%BD%9C%E4%B8%80%E4%B8%AA%E5%B0%8F%E6%B8%B8%E6%88%8F/"}</script><title>学习Pixi并制作一个小游戏 | Chenng's Home</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Chenng's Home"><meta name="application-name" content="Chenng's Home"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://cdn-1257430323.cos.ap-guangzhou.myqcloud.com/assets/imgs/20210506201457_0026033cb6769057453d0142751005ae.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Chenng's Home</a></div><div class="site-subtitle font-italic"></div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/ringcrl" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['ringcrl','foxmail.com'].join('@')" aria-label="email" class="order-4" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-5" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>学习Pixi并制作一个小游戏</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>学习Pixi并制作一个小游戏</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> chenng </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Dec 16, 2017, 12:00 AM +0800" prep="on" > Dec 16, 2017 <i class="unloaded">2017-12-16T00:00:00+08:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4704 words">26 min</span></div></div><div class="post-content"><p>学习用 PixiJS 制作游戏和互动媒体。</p><h1 id="初始化-pixi">初始化 pixi</h1><div class="language-html highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;title&gt;</span>Hello World<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"pixi.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
      <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">WebGL</span><span class="dl">"</span><span class="p">;</span>
      <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">PIXI</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nf">isWebGLSupported</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">type</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Canvas</span><span class="dl">"</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="nx">PIXI</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nf">sayHello</span><span class="p">(</span><span class="nx">type</span><span class="p">);</span>
    <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p>控制台会打印 pixi 使用的是 WebGL 还是 Canvas</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>Pixi.js 4.0.0 - ✰ WebGL ✰      http://www.pixijs.com/    ♥♥♥
</pre></table></code></div></div><h1 id="创建渲染器和舞台">创建渲染器和舞台</h1><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c1">//Create the renderer</span>
<span class="kd">var</span> <span class="nx">renderer</span> <span class="o">=</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nf">autoDetectRenderer</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">);</span>
<span class="c1">//Add the canvas to the HTML document</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">renderer</span><span class="p">.</span><span class="nx">view</span><span class="p">);</span>
<span class="c1">//Create a container object called the `stage`</span>
<span class="kd">var</span> <span class="nx">stage</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nc">Container</span><span class="p">();</span>
<span class="c1">//Tell the `renderer` to `render` the `stage`</span>
<span class="nx">renderer</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="nx">stage</span><span class="p">);</span>
</pre></table></code></div></div><p>renderer.view 对象只是一个再普通不过的 <code class="language-plaintext highlighter-rouge">&lt;canvas&gt;</code> 对象，所以你可以像控制其他任何 canvas 对象一样控制它。</p><p>stage 是一个 Pixi Container 对象。你可以把这个容器想象成一个可以把你所有想放的东西放进去的一种空盒子。 我们创建的 stage 对象是在你创建的场景中所有可视物体的根容器。Pixi 需要你有一个根容器，因为 renderer 需要有一个东西去渲染上去。不管你往这个 stage 里面放什么都会被渲染到 canvas 上面。现在这个 stage 是空的。</p><p>给 canvas 一个虚线边框：</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">renderer</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">border</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1px dashed black</span><span class="dl">"</span><span class="p">;</span>
</pre></table></code></div></div><p>如果你想在创建 canvas 后改变它的背景颜色，设置 renderer 对象的 backgroundColor 属性为其他任何十六进制的颜色值：</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">renderer</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="mh">0x061639</span><span class="p">;</span>
</pre></table></code></div></div><p>如果你想获取 renderer 的宽和高，用 <code class="language-plaintext highlighter-rouge">renderer.view.width</code> 和 <code class="language-plaintext highlighter-rouge">renderer.view.height</code>。尽管 stage 也有 width 和 height 属性，它们不是指渲染窗口的大小。舞台的 width 和 height 只是告诉你你放的东西所占用的区域。</p><p>可以用 renderer 的 resize 方法设置任何新的 width 和 height 值去改变 canvas 的大小。但是，请确保 canvas 和分辨率是大小相匹配的，设置 autoResize 为 true。</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nx">renderer</span><span class="p">.</span><span class="nx">autoResize</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nx">renderer</span><span class="p">.</span><span class="nf">resize</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">);</span>
</pre></table></code></div></div><p>如果你想让 canvas 占据整个窗口，你可以设置 CSS 样式并且调整渲染器的大小为浏览器窗口的大小。</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nx">renderer</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">absolute</span><span class="dl">"</span><span class="p">;</span>
<span class="nx">renderer</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">block</span><span class="dl">"</span><span class="p">;</span>
<span class="nx">renderer</span><span class="p">.</span><span class="nx">autoResize</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nx">renderer</span><span class="p">.</span><span class="nf">resize</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">);</span>
</pre></table></code></div></div><h1 id="pixi-精灵">Pixi 精灵</h1><p>Pixi 有一个 Sprite 类，它是创建游戏精灵的通用方式。这里还有三个主要的方式去创建它们</p><ul><li>使用单独一个图片文件<li>使用图片集的一个子图像。图片集是一个单独的，大的图像，它包含了所有游戏中你需要的图片。（雪碧图）<li>使用纹理图集（一个定义了在雪碧图中每个子图的位置和大小的 JSON 文件）</ul><h1 id="加载图像到纹理缓存中">加载图像到纹理缓存中</h1><p>因为 Pixi 通过 WebGL 在 GPU 上渲染图像，图像需要被格式化为 GPU 可以处理的格式。一个为 WebGL 准备的图像称为 <code class="language-plaintext highlighter-rouge">纹理</code>。Pixi 使用了一个 <code class="language-plaintext highlighter-rouge">纹理缓存</code> 去存储和引用所有精灵图所需要的纹理。纹理的名字是一个指向图片文件的位置的字符串。可以通过这个方法来在纹理缓存中找到图像。</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">catTexture</span> <span class="o">=</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">TextureCache</span><span class="p">[</span><span class="dl">"</span><span class="s2">images/cat.png</span><span class="dl">"</span><span class="p">];</span>
<span class="kd">const</span> <span class="nx">catSprite</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nc">Sprite</span><span class="p">(</span><span class="nx">catTexture</span><span class="p">);</span>
</pre></table></code></div></div><p>用 Pixi 的内置 loader 对象，可以加载一个图片并把它转化为一个纹理。Pixi 强大的 loader 对象是你加载任何一种图像的全部所需。这里告诉你了如何加载一个图像并在图像加载完成之后调用 setup 函数。</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nx">PIXI</span><span class="p">.</span><span class="nx">loader</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">images/anyImage.png</span><span class="dl">"</span><span class="p">).</span><span class="nf">load</span><span class="p">(</span><span class="nx">setup</span><span class="p">);</span>

<span class="kd">function</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">//This code will run when the loader has finished loading the image</span>
<span class="p">}</span>
</pre></table></code></div></div><p>如果你使用了加载器，你应该通过引用纹理中的 loader 的 resources 对象来创建精灵。</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">sprite</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nc">Sprite</span><span class="p">(</span>
  <span class="nx">PIXI</span><span class="p">.</span><span class="nx">loader</span><span class="p">.</span><span class="nx">resources</span><span class="p">[</span><span class="dl">"</span><span class="s2">images/anyImage.png</span><span class="dl">"</span><span class="p">].</span><span class="nx">texture</span>
<span class="p">);</span>
</pre></table></code></div></div><p>可以通过它来加载一个图像，调用 setup 函数，并且从加载过的图像中创建一个精灵：</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nx">PIXI</span><span class="p">.</span><span class="nx">loader</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">images/anyImage.png</span><span class="dl">"</span><span class="p">).</span><span class="nf">load</span><span class="p">(</span><span class="nx">setup</span><span class="p">);</span>

<span class="kd">function</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">sprite</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nc">Sprite</span><span class="p">(</span>
    <span class="nx">PIXI</span><span class="p">.</span><span class="nx">loader</span><span class="p">.</span><span class="nx">resources</span><span class="p">[</span><span class="dl">"</span><span class="s2">images/anyImage.png</span><span class="dl">"</span><span class="p">].</span><span class="nx">texture</span>
  <span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>一次性加载许多图像，可以把所有的你想加载的文件放到一个数组里：</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nx">PIXI</span><span class="p">.</span><span class="nx">loader</span>
  <span class="p">.</span><span class="nf">add</span><span class="p">([</span><span class="dl">"</span><span class="s2">images/imageOne.png</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">images/imageTwo.png</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">images/imageThree.png</span><span class="dl">"</span><span class="p">])</span>
  <span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="nx">setup</span><span class="p">);</span>
</pre></table></code></div></div><h1 id="展示精灵">展示精灵</h1><p>想要在 canvas 上看到它，需要做两件事</p><ul><li>通过 <code class="language-plaintext highlighter-rouge">stage.addChild</code> 方法把精灵添加到 Pixi 的 <code class="language-plaintext highlighter-rouge">stage</code> 中<li>需要告诉 Pixi 的 <code class="language-plaintext highlighter-rouge">renderer</code> 去渲染这个舞台</ul><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nx">stage</span><span class="p">.</span><span class="nf">addChild</span><span class="p">(</span><span class="nx">cat</span><span class="p">);</span>

<span class="nx">renderer</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="nx">stage</span><span class="p">);</span>
</pre></table></code></div></div><p>加载图像，创建一个精灵，并把它展示在 Pixi 舞台上的所有的 JavaScript 代码：</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">stage</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nc">Container</span><span class="p">(),</span>
  <span class="nx">renderer</span> <span class="o">=</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nf">autoDetectRenderer</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">renderer</span><span class="p">.</span><span class="nx">view</span><span class="p">);</span>

<span class="c1">//Use Pixi's built-in `loader` object to load an image</span>
<span class="nx">PIXI</span><span class="p">.</span><span class="nx">loader</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">images/cat.png</span><span class="dl">"</span><span class="p">).</span><span class="nf">load</span><span class="p">(</span><span class="nx">setup</span><span class="p">);</span>

<span class="c1">//This `setup` function will run when the image has loaded</span>
<span class="kd">function</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">//Create the `cat` sprite from the texture</span>
  <span class="kd">var</span> <span class="nx">cat</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nc">Sprite</span><span class="p">(</span><span class="nx">PIXI</span><span class="p">.</span><span class="nx">loader</span><span class="p">.</span><span class="nx">resources</span><span class="p">[</span><span class="dl">"</span><span class="s2">images/cat.png</span><span class="dl">"</span><span class="p">].</span><span class="nx">texture</span><span class="p">);</span>

  <span class="c1">//Add the cat to the stage</span>
  <span class="nx">stage</span><span class="p">.</span><span class="nf">addChild</span><span class="p">(</span><span class="nx">cat</span><span class="p">);</span>

  <span class="c1">//Render the stage</span>
  <span class="nx">renderer</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="nx">stage</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>如果你想从舞台中移除一个精灵，用 removeChild 方法：</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">stage</span><span class="p">.</span><span class="nf">removeChild</span><span class="p">(</span><span class="nx">anySprite</span><span class="p">);</span>
</pre></table></code></div></div><p>但是通常设置精灵的 visible 属性为 false 是一个让精灵消失的高效而且简单方式。</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">anySprite</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</pre></table></code></div></div><h1 id="创建别名">创建别名</h1><ul><li>Sprite 是 PIXI.Sprite 的别名<li>TextureCache 是 PIXI.utils.TextureCache 的别名<li>resources 是 PIXI.loader.resources 的别名<li>Rectangle 是 PIXI.Rectangle 的别名</ul><h1 id="监控加载进度">监控加载进度</h1><p>Pixi 的加载器有一个特殊的 progress 事件会在每次当一个文件加载的时候调用一个可定制的函数。 progress 事件会被 loader 的 on 方法调用：</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">PIXI</span><span class="p">.</span><span class="nx">loader</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">progress</span><span class="dl">"</span><span class="p">,</span> <span class="nx">loadProgressHandler</span><span class="p">);</span>
</pre></table></code></div></div><p>可以明确的指明哪个文件已经加载了以及文件加载的百分比，可以通过给 loadProgressHandler 添加 loader 和 resource 参数：</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="nx">PIXI</span><span class="p">.</span><span class="nx">loader</span>
  <span class="p">.</span><span class="nf">add</span><span class="p">([</span><span class="dl">"</span><span class="s2">images/one.png</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">images/two.png</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">images/three.png</span><span class="dl">"</span><span class="p">])</span>
  <span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">progress</span><span class="dl">"</span><span class="p">,</span> <span class="nx">loadProgressHandler</span><span class="p">)</span>
  <span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="nx">setup</span><span class="p">);</span>

<span class="kd">function</span> <span class="nf">loadProgressHandler</span><span class="p">(</span><span class="nx">loader</span><span class="p">,</span> <span class="nx">resource</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">//Display the file `url` currently being loaded</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">loading: </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">resource</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>

  <span class="c1">//Display the precentage of files currently loaded</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">progress: </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">loader</span><span class="p">.</span><span class="nx">progress</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">%</span><span class="dl">"</span><span class="p">);</span>

  <span class="c1">//If you gave your files names as the first argument</span>
  <span class="c1">//of the `add` method, you can access them like this</span>
  <span class="c1">//console.log("loading: " + resource.name);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">All files loaded</span><span class="dl">"</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><h1 id="定位精灵">定位精灵</h1><p>创建完精灵后可以更改其位置</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kd">function</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">//Create the `cat` sprite</span>
  <span class="kd">var</span> <span class="nx">cat</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Sprite</span><span class="p">(</span><span class="nx">resources</span><span class="p">[</span><span class="dl">"</span><span class="s2">images/cat.png</span><span class="dl">"</span><span class="p">].</span><span class="nx">texture</span><span class="p">);</span>

  <span class="c1">//Change the sprite's position</span>
  <span class="nx">cat</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">96</span><span class="p">;</span>
  <span class="nx">cat</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">96</span><span class="p">;</span>

  <span class="c1">//Add the cat to the stage so you can see it</span>
  <span class="nx">stage</span><span class="p">.</span><span class="nf">addChild</span><span class="p">(</span><span class="nx">cat</span><span class="p">);</span>

  <span class="c1">//Render the stage</span>
  <span class="nx">renderer</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="nx">stage</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>可以用一行代码把 x 和 y 的值一起设置，而不是单独设置：</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">sprite</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
</pre></table></code></div></div><h1 id="尺寸和缩放">尺寸和缩放</h1><p>设置尺寸</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="c1">//Change the sprite's size</span>
<span class="nx">cat</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>
<span class="nx">cat</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="mi">120</span><span class="p">;</span>
</pre></table></code></div></div><p>可以直接通过属性设置缩放，当然用 set 方法最好</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">cat</span><span class="p">.</span><span class="nx">scale</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">);</span>
</pre></table></code></div></div><h1 id="旋转">旋转</h1><p>旋转之前先设置中心点</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c1">// 百分比设置法</span>
<span class="nx">cat</span><span class="p">.</span><span class="nx">anchor</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
<span class="nx">cat</span><span class="p">.</span><span class="nx">anchor</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>

<span class="c1">// x 和 y 的值设置法</span>
<span class="nx">sprite</span><span class="p">.</span><span class="nx">anchor</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
</pre></table></code></div></div><h1 id="用雪碧图的子图像制作精灵">用雪碧图的子图像制作精灵</h1><p>你通常会把你的精灵图制作成图集（也叫雪碧图。）Pixi 有一些内置的简便的方式帮助你做到这些。</p><p>当图片加载完成，用一个雪碧图的矩形项去创造一个精灵图片。这里的代码就展示如何提取子图，创建火箭图像，定位并且在 canvas 中展示它。</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="kd">function</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">//Create the `tileset` sprite from the texture</span>
  <span class="kd">var</span> <span class="nx">texture</span> <span class="o">=</span> <span class="nx">TextureCache</span><span class="p">[</span><span class="dl">"</span><span class="s2">images/tileset.png</span><span class="dl">"</span><span class="p">];</span>

  <span class="c1">//Create a rectangle object that defines the position and</span>
  <span class="c1">//size of the sub-image you want to extract from the texture</span>
  <span class="kd">var</span> <span class="nx">rectangle</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Rectangle</span><span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">);</span>

  <span class="c1">//Tell the texture to use that rectangular section</span>
  <span class="nx">texture</span><span class="p">.</span><span class="nx">frame</span> <span class="o">=</span> <span class="nx">rectangle</span><span class="p">;</span>

  <span class="c1">//Create the sprite from the texture</span>
  <span class="kd">var</span> <span class="nx">rocket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Sprite</span><span class="p">(</span><span class="nx">texture</span><span class="p">);</span>

  <span class="c1">//Position the rocket sprite on the canvas</span>
  <span class="nx">rocket</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
  <span class="nx">rocket</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>

  <span class="c1">//Add the rocket to the stage</span>
  <span class="nx">stage</span><span class="p">.</span><span class="nf">addChild</span><span class="p">(</span><span class="nx">rocket</span><span class="p">);</span>

  <span class="c1">//Render the stage</span>
  <span class="nx">renderer</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="nx">stage</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><h1 id="使用纹理图集">使用纹理图集</h1><p>使用免费版的 Texture Packer，设置 Algorithm 为 Basic，设置 Trim mode 为 None，设置 Size constraints 为 Any size 然后滑动 PNG Opt Level 到最左为 0。这是让你利用免费版的 Texture Packer 创建你的文件不会报错和警告的最基本的做法。 ）</p><p>当你完成之后，点击 Publish 按钮。选择文件的名字的位置，然后保存发布文件。你将会得到两个文件：一个 PNG 文件和一个 JSON 文件。在这个例子中我的文件名字叫 treasureHunter.json 和 treasureHunter.png。</p><div class="language-json highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nl">"blob.png"</span><span class="p">:</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"frame"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"x"</span><span class="p">:</span><span class="mi">55</span><span class="p">,</span><span class="nl">"y"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="nl">"w"</span><span class="p">:</span><span class="mi">32</span><span class="p">,</span><span class="nl">"h"</span><span class="p">:</span><span class="mi">24</span><span class="p">},</span><span class="w">
  </span><span class="nl">"rotated"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nl">"trimmed"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nl">"spriteSourceSize"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"x"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nl">"y"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nl">"w"</span><span class="p">:</span><span class="mi">32</span><span class="p">,</span><span class="nl">"h"</span><span class="p">:</span><span class="mi">24</span><span class="p">},</span><span class="w">
  </span><span class="nl">"sourceSize"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"w"</span><span class="p">:</span><span class="mi">32</span><span class="p">,</span><span class="nl">"h"</span><span class="p">:</span><span class="mi">24</span><span class="p">},</span><span class="w">
  </span><span class="nl">"pivot"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"x"</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span><span class="nl">"y"</span><span class="p">:</span><span class="mf">0.5</span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="err">,</span><span class="w">
</span></pre></table></code></div></div><h1 id="加载纹理图集">加载纹理图集</h1><p>为了把纹理图集加入 Pixi，用 Pixi 的 loader 加载它。如果你是用 Texture Packer 制作的 JSON 文件，loader 会自动在雪碧图上解释数据和创建纹理图。</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">loader</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">images/treasureHunter.json</span><span class="dl">"</span><span class="p">).</span><span class="nf">load</span><span class="p">(</span><span class="nx">setup</span><span class="p">);</span>
</pre></table></code></div></div><h1 id="从加载过的纹理图集创建精灵">从加载过的纹理图集创建精灵</h1><p>用 TextureCache:</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">texture</span> <span class="o">=</span> <span class="nx">TextureCache</span><span class="p">[</span><span class="dl">"</span><span class="s2">frameId.png</span><span class="dl">"</span><span class="p">],</span>
  <span class="nx">sprite</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Sprite</span><span class="p">(</span><span class="nx">texture</span><span class="p">);</span>
</pre></table></code></div></div><h1 id="移动精灵">移动精灵</h1><p>用 requestAnimationFrame 创建一个循环函数。这被称为 游戏循环。 任何在游戏循环里的代码都会 1s 更新 60 次。你可以用下面的代码让 cat 精灵以每帧 1 像素的速率移动。</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="kd">function</span> <span class="nf">gameLoop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">//Loop this function at 60 frames per second</span>
  <span class="nf">requestAnimationFrame</span><span class="p">(</span><span class="nx">gameLoop</span><span class="p">);</span>

  <span class="c1">//Move the cat 1 pixel to the right each frame</span>
  <span class="nx">cat</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="c1">//Render the stage to see the animation</span>
  <span class="nx">renderer</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="nx">stage</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//Start the game loop</span>
<span class="nf">gameLoop</span><span class="p">();</span>
</pre></table></code></div></div><h1 id="游戏状态">游戏状态</h1><p>作为一种风格，也是为了帮你模块你的代码，我推荐在游戏循环里像这样组织你的代码：</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="c1">//Set the game's current state to `play`:</span>
<span class="kd">var</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">play</span><span class="p">;</span>

<span class="kd">function</span> <span class="nf">gameLoop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">//Loop this function at 60 frames per second</span>
  <span class="nf">requestAnimationFrame</span><span class="p">(</span><span class="nx">gameLoop</span><span class="p">);</span>

  <span class="c1">//Update the current game state:</span>
  <span class="nf">state</span><span class="p">();</span>

  <span class="c1">//Render the stage to see the animation</span>
  <span class="nx">renderer</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="nx">stage</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">play</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">//Move the cat 1 pixel to the right each frame</span>
  <span class="nx">cat</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><h1 id="键盘移动">键盘移动</h1><p>只需再做一小点工作，你就可以建立一个通过鼠标控制精灵移动的简单系统。为了简化你的代码，我建议你用一个名为 keyboard 的自定义函数来监听和捕捉键盘事件。</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="kd">function</span> <span class="nf">keyboard</span><span class="p">(</span><span class="nx">keyCode</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="nx">key</span><span class="p">.</span><span class="nx">code</span> <span class="o">=</span> <span class="nx">keyCode</span><span class="p">;</span>
  <span class="nx">key</span><span class="p">.</span><span class="nx">isDown</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">key</span><span class="p">.</span><span class="nx">isUp</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">key</span><span class="p">.</span><span class="nx">press</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
  <span class="nx">key</span><span class="p">.</span><span class="nx">release</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
  <span class="c1">//The `downHandler`</span>
  <span class="nx">key</span><span class="p">.</span><span class="nx">downHandler</span> <span class="o">=</span> <span class="nf">function </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">===</span> <span class="nx">key</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">key</span><span class="p">.</span><span class="nx">isUp</span> <span class="o">&amp;&amp;</span> <span class="nx">key</span><span class="p">.</span><span class="nx">press</span><span class="p">)</span> <span class="nx">key</span><span class="p">.</span><span class="nf">press</span><span class="p">();</span>
      <span class="nx">key</span><span class="p">.</span><span class="nx">isDown</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">key</span><span class="p">.</span><span class="nx">isUp</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">event</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>
  <span class="p">};</span>

  <span class="c1">//The `upHandler`</span>
  <span class="nx">key</span><span class="p">.</span><span class="nx">upHandler</span> <span class="o">=</span> <span class="nf">function </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">===</span> <span class="nx">key</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">key</span><span class="p">.</span><span class="nx">isDown</span> <span class="o">&amp;&amp;</span> <span class="nx">key</span><span class="p">.</span><span class="nx">release</span><span class="p">)</span> <span class="nx">key</span><span class="p">.</span><span class="nf">release</span><span class="p">();</span>
      <span class="nx">key</span><span class="p">.</span><span class="nx">isDown</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="nx">key</span><span class="p">.</span><span class="nx">isUp</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">event</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>
  <span class="p">};</span>

  <span class="c1">//Attach event listeners</span>
  <span class="nb">window</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">keydown</span><span class="dl">"</span><span class="p">,</span> <span class="nx">key</span><span class="p">.</span><span class="nx">downHandler</span><span class="p">.</span><span class="nf">bind</span><span class="p">(</span><span class="nx">key</span><span class="p">),</span> <span class="kc">false</span><span class="p">);</span>
  <span class="nb">window</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">keyup</span><span class="dl">"</span><span class="p">,</span> <span class="nx">key</span><span class="p">.</span><span class="nx">upHandler</span><span class="p">.</span><span class="nf">bind</span><span class="p">(</span><span class="nx">key</span><span class="p">),</span> <span class="kc">false</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">key</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>keyboard 函数很容易使用，可以像这样创建一个新的键盘对象：</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">keyObject</span> <span class="o">=</span> <span class="nf">keyboard</span><span class="p">(</span><span class="nx">asciiKeyCodeNumber</span><span class="p">);</span>
</pre></table></code></div></div><p>这个函数只接受一个参数就是键盘对应的 ASCII 键值数，也就是你想监听的键盘按键。然后给键盘对象赋值 press 和 release 方法：</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nx">keyObject</span><span class="p">.</span><span class="nx">press</span> <span class="o">=</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">//key object pressed</span>
<span class="p">};</span>
<span class="nx">keyObject</span><span class="p">.</span><span class="nx">release</span> <span class="o">=</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">//key object released</span>
<span class="p">};</span>
</pre></table></code></div></div><h1 id="更多">更多</h1><p>中间还有不少基础的教学</p><h1 id="实战教学宝藏猎手">实战教学：宝藏猎手</h1><p>玩耍地址：<a href="https://static.chenng.cn/treasure-hunter/index.html">https://static.chenng.cn/treasure-hunter/index.html</a></p><p>宝藏猎手是一个简单的完整的游戏之一，它是一个很好的例子，它能让你把目前所学的所有工具都用上。</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
</pre><td class="rouge-code"><pre><span class="c1">// 设置别名</span>
<span class="kd">var</span> <span class="nx">Container</span> <span class="o">=</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nx">Container</span><span class="p">,</span>
  <span class="nx">autoDetectRenderer</span> <span class="o">=</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nx">autoDetectRenderer</span><span class="p">,</span>
  <span class="nx">loader</span> <span class="o">=</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nx">loader</span><span class="p">,</span>
  <span class="nx">resources</span> <span class="o">=</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nx">loader</span><span class="p">.</span><span class="nx">resources</span><span class="p">,</span>
  <span class="nx">TextureCache</span> <span class="o">=</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">TextureCache</span><span class="p">,</span>
  <span class="nx">Texture</span> <span class="o">=</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nx">Texture</span><span class="p">,</span>
  <span class="nx">Sprite</span> <span class="o">=</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nx">Sprite</span><span class="p">,</span>
  <span class="nx">Text</span> <span class="o">=</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nx">Text</span><span class="p">,</span>
  <span class="nx">Graphics</span> <span class="o">=</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nx">Graphics</span><span class="p">;</span>

<span class="c1">//Create a Pixi stage and renderer and add the</span>
<span class="c1">//renderer.view to the DOM</span>
<span class="c1">// 创建 PIXI 舞台，renderer，添加 render.view 到 DOM 中</span>
<span class="kd">var</span> <span class="nx">stage</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Container</span><span class="p">(),</span>
  <span class="nx">renderer</span> <span class="o">=</span> <span class="nf">autoDetectRenderer</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">renderer</span><span class="p">.</span><span class="nx">view</span><span class="p">);</span>

<span class="nx">loader</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">images/treasureHunter.json</span><span class="dl">"</span><span class="p">).</span><span class="nf">load</span><span class="p">(</span><span class="nx">setup</span><span class="p">);</span>

<span class="c1">// 定义不知在一个地方使用的变量</span>
<span class="kd">var</span> <span class="nx">state</span><span class="p">,</span>
  <span class="nx">explorer</span><span class="p">,</span>
  <span class="nx">treasure</span><span class="p">,</span>
  <span class="nx">blobs</span><span class="p">,</span>
  <span class="nx">chimes</span><span class="p">,</span>
  <span class="nx">exit</span><span class="p">,</span>
  <span class="nx">player</span><span class="p">,</span>
  <span class="nx">dungeon</span><span class="p">,</span>
  <span class="nx">door</span><span class="p">,</span>
  <span class="nx">healthBar</span><span class="p">,</span>
  <span class="nx">message</span><span class="p">,</span>
  <span class="nx">gameScene</span><span class="p">,</span>
  <span class="nx">gameOverScene</span><span class="p">,</span>
  <span class="nx">enemies</span><span class="p">,</span>
  <span class="nx">id</span><span class="p">;</span>

<span class="c1">// 初始化 Pixi、加载地图册文件</span>
<span class="kd">function</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// 初始化地图精灵，将游戏状态设置为 play，然后开始游戏</span>

  <span class="c1">// 创建游戏运行场景分组</span>
  <span class="nx">gameScene</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Container</span><span class="p">();</span>
  <span class="nx">stage</span><span class="p">.</span><span class="nf">addChild</span><span class="p">(</span><span class="nx">gameScene</span><span class="p">);</span>

  <span class="c1">// 为获取资源的方法设置一个简短的别名</span>
  <span class="nx">id</span> <span class="o">=</span> <span class="nx">resources</span><span class="p">[</span><span class="dl">"</span><span class="s2">images/treasureHunter.json</span><span class="dl">"</span><span class="p">].</span><span class="nx">textures</span><span class="p">;</span>

  <span class="c1">// 创建地牢精灵</span>
  <span class="nx">dungeon</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Sprite</span><span class="p">(</span><span class="nx">id</span><span class="p">[</span><span class="dl">"</span><span class="s2">dungeon.png</span><span class="dl">"</span><span class="p">]);</span>
  <span class="nx">gameScene</span><span class="p">.</span><span class="nf">addChild</span><span class="p">(</span><span class="nx">dungeon</span><span class="p">);</span>

  <span class="c1">// 创建门精灵</span>
  <span class="nx">door</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Sprite</span><span class="p">(</span><span class="nx">id</span><span class="p">[</span><span class="dl">"</span><span class="s2">door.png</span><span class="dl">"</span><span class="p">]);</span>
  <span class="nx">door</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="nx">gameScene</span><span class="p">.</span><span class="nf">addChild</span><span class="p">(</span><span class="nx">door</span><span class="p">);</span>

  <span class="c1">// 创建探索者精灵</span>
  <span class="nx">explorer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Sprite</span><span class="p">(</span><span class="nx">id</span><span class="p">[</span><span class="dl">"</span><span class="s2">explorer.png</span><span class="dl">"</span><span class="p">]);</span>
  <span class="nx">explorer</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">68</span><span class="p">;</span>
  <span class="nx">explorer</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">gameScene</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="nx">explorer</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
  <span class="nx">explorer</span><span class="p">.</span><span class="nx">vx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">explorer</span><span class="p">.</span><span class="nx">vy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">gameScene</span><span class="p">.</span><span class="nf">addChild</span><span class="p">(</span><span class="nx">explorer</span><span class="p">);</span>

  <span class="c1">// 创建宝藏精灵</span>
  <span class="nx">treasure</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Sprite</span><span class="p">(</span><span class="nx">id</span><span class="p">[</span><span class="dl">"</span><span class="s2">treasure.png</span><span class="dl">"</span><span class="p">]);</span>
  <span class="nx">treasure</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">gameScene</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">treasure</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">48</span><span class="p">;</span>
  <span class="nx">treasure</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">gameScene</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="nx">treasure</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
  <span class="nx">gameScene</span><span class="p">.</span><span class="nf">addChild</span><span class="p">(</span><span class="nx">treasure</span><span class="p">);</span>

  <span class="c1">// 设置游戏结束场景分组</span>
  <span class="nx">gameOverScene</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Container</span><span class="p">();</span>
  <span class="nx">gameOverScene</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">stage</span><span class="p">.</span><span class="nf">addChild</span><span class="p">(</span><span class="nx">gameOverScene</span><span class="p">);</span>

  <span class="c1">// 创建一堆的怪物</span>
  <span class="kd">let</span> <span class="nx">numberOfBlobs</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
    <span class="nx">spacing</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span>
    <span class="nx">xOffset</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>
    <span class="nx">speed</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="nx">direction</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="c1">// 一个存储所有怪物的数组</span>
  <span class="nx">blobs</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="c1">// 根据设置的数量制造怪物实体</span>
  <span class="k">for </span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">numberOfBlobs</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">blob</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Sprite</span><span class="p">(</span><span class="nx">id</span><span class="p">[</span><span class="dl">"</span><span class="s2">blob.png</span><span class="dl">"</span><span class="p">]);</span>
    <span class="c1">// 根据间距、偏移设置怪物实体的水平位置</span>
    <span class="kd">let</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">spacing</span> <span class="o">*</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">xOffset</span><span class="p">;</span>
    <span class="c1">// 给实体一个随机的 y 位置</span>
    <span class="kd">let</span> <span class="nx">y</span> <span class="o">=</span> <span class="nf">randomInt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">stage</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">blob</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
    <span class="c1">// 设置实体的位置</span>
    <span class="nx">blob</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
    <span class="nx">blob</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span>
    <span class="c1">// 设置实体的垂直加速度</span>
    <span class="nx">blob</span><span class="p">.</span><span class="nx">vy</span> <span class="o">=</span> <span class="nx">speed</span> <span class="o">*</span> <span class="nx">direction</span><span class="p">;</span>
    <span class="c1">// 翻转下一个实体的方向</span>
    <span class="nx">direction</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="c1">// 将实体塞入集合</span>
    <span class="nx">blobs</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="nx">blob</span><span class="p">);</span>
    <span class="c1">// 将实体加入游戏场景</span>
    <span class="nx">gameScene</span><span class="p">.</span><span class="nf">addChild</span><span class="p">(</span><span class="nx">blob</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// 添加血条</span>
  <span class="nx">healthBar</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nc">DisplayObjectContainer</span><span class="p">();</span>
  <span class="nx">healthBar</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="nx">stage</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">170</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
  <span class="nx">gameScene</span><span class="p">.</span><span class="nf">addChild</span><span class="p">(</span><span class="nx">healthBar</span><span class="p">);</span>
  <span class="c1">// 创建后面的黑色矩形</span>
  <span class="kd">let</span> <span class="nx">innerBar</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nc">Graphics</span><span class="p">();</span>
  <span class="nx">innerBar</span><span class="p">.</span><span class="nf">beginFill</span><span class="p">(</span><span class="mh">0x000000</span><span class="p">);</span>
  <span class="nx">innerBar</span><span class="p">.</span><span class="nf">drawRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
  <span class="nx">innerBar</span><span class="p">.</span><span class="nf">endFill</span><span class="p">();</span>
  <span class="nx">healthBar</span><span class="p">.</span><span class="nf">addChild</span><span class="p">(</span><span class="nx">innerBar</span><span class="p">);</span>
  <span class="c1">// 创建前面的红色矩形</span>
  <span class="kd">let</span> <span class="nx">outerBar</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nc">Graphics</span><span class="p">();</span>
  <span class="nx">outerBar</span><span class="p">.</span><span class="nf">beginFill</span><span class="p">(</span><span class="mh">0xff3300</span><span class="p">);</span>
  <span class="nx">outerBar</span><span class="p">.</span><span class="nf">drawRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
  <span class="nx">outerBar</span><span class="p">.</span><span class="nf">endFill</span><span class="p">();</span>
  <span class="nx">healthBar</span><span class="p">.</span><span class="nf">addChild</span><span class="p">(</span><span class="nx">outerBar</span><span class="p">);</span>
  <span class="c1">// 在 healthBar 上面添加个红色矩形的引用，过会儿能很方便的获取</span>
  <span class="c1">// 如果你想控制红色 outerBar 的宽度，可以这么做 healthBar.outer.width = 30;</span>
  <span class="nx">healthBar</span><span class="p">.</span><span class="nx">outer</span> <span class="o">=</span> <span class="nx">outerBar</span><span class="p">;</span>

  <span class="c1">// 制作消息文字</span>
  <span class="nx">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Text</span><span class="p">(</span><span class="dl">"</span><span class="s2">The End</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span> <span class="na">font</span><span class="p">:</span> <span class="dl">"</span><span class="s2">64px Futura</span><span class="dl">"</span><span class="p">,</span> <span class="na">fill</span><span class="p">:</span> <span class="dl">"</span><span class="s2">white</span><span class="dl">"</span> <span class="p">});</span>
  <span class="nx">message</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">120</span><span class="p">;</span>
  <span class="nx">message</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">stage</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">32</span><span class="p">;</span>
  <span class="nx">gameOverScene</span><span class="p">.</span><span class="nf">addChild</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>

  <span class="c1">// 捕获键盘操作</span>
  <span class="kd">let</span> <span class="nx">left</span> <span class="o">=</span> <span class="nf">keyboard</span><span class="p">(</span><span class="mi">37</span><span class="p">),</span>
    <span class="nx">up</span> <span class="o">=</span> <span class="nf">keyboard</span><span class="p">(</span><span class="mi">38</span><span class="p">),</span>
    <span class="nx">right</span> <span class="o">=</span> <span class="nf">keyboard</span><span class="p">(</span><span class="mi">39</span><span class="p">),</span>
    <span class="nx">down</span> <span class="o">=</span> <span class="nf">keyboard</span><span class="p">(</span><span class="mi">40</span><span class="p">);</span>
  <span class="nx">left</span><span class="p">.</span><span class="nx">press</span> <span class="o">=</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">explorer</span><span class="p">.</span><span class="nx">vx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span><span class="p">;</span>
    <span class="nx">explorer</span><span class="p">.</span><span class="nx">vy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="nx">left</span><span class="p">.</span><span class="nx">release</span> <span class="o">=</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">right</span><span class="p">.</span><span class="nx">isDown</span> <span class="o">&amp;&amp;</span> <span class="nx">explorer</span><span class="p">.</span><span class="nx">vy</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">explorer</span><span class="p">.</span><span class="nx">vx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">up</span><span class="p">.</span><span class="nx">press</span> <span class="o">=</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">explorer</span><span class="p">.</span><span class="nx">vy</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span><span class="p">;</span>
    <span class="nx">explorer</span><span class="p">.</span><span class="nx">vx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="nx">up</span><span class="p">.</span><span class="nx">release</span> <span class="o">=</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">down</span><span class="p">.</span><span class="nx">isDown</span> <span class="o">&amp;&amp;</span> <span class="nx">explorer</span><span class="p">.</span><span class="nx">vx</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">explorer</span><span class="p">.</span><span class="nx">vy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">right</span><span class="p">.</span><span class="nx">press</span> <span class="o">=</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">explorer</span><span class="p">.</span><span class="nx">vx</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="nx">explorer</span><span class="p">.</span><span class="nx">vy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="nx">right</span><span class="p">.</span><span class="nx">release</span> <span class="o">=</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">left</span><span class="p">.</span><span class="nx">isDown</span> <span class="o">&amp;&amp;</span> <span class="nx">explorer</span><span class="p">.</span><span class="nx">vy</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">explorer</span><span class="p">.</span><span class="nx">vx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">down</span><span class="p">.</span><span class="nx">press</span> <span class="o">=</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">explorer</span><span class="p">.</span><span class="nx">vy</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="nx">explorer</span><span class="p">.</span><span class="nx">vx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="nx">down</span><span class="p">.</span><span class="nx">release</span> <span class="o">=</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">up</span><span class="p">.</span><span class="nx">isDown</span> <span class="o">&amp;&amp;</span> <span class="nx">explorer</span><span class="p">.</span><span class="nx">vx</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">explorer</span><span class="p">.</span><span class="nx">vy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="c1">// 设置游戏状态为 play</span>
  <span class="nx">state</span> <span class="o">=</span> <span class="nx">play</span><span class="p">;</span>

  <span class="c1">// 开始游戏循环</span>
  <span class="nf">gameLoop</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// 游戏循环运行</span>
<span class="kd">function</span> <span class="nf">gameLoop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// 每秒 60 次更新 state 函数</span>
  <span class="nf">requestAnimationFrame</span><span class="p">(</span><span class="nx">gameLoop</span><span class="p">);</span>

  <span class="c1">// 更新游戏状态，state 函数有 play 和 end 两种状态</span>
  <span class="nf">state</span><span class="p">();</span>

  <span class="c1">// 渲染舞台</span>
  <span class="nx">renderer</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="nx">stage</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 所有让精灵移动的游戏逻辑都在 play 里，这是一个被循环执行的函数</span>
<span class="kd">function</span> <span class="nf">play</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// 移动探索者，并限制他在地牢范围内</span>
  <span class="nx">explorer</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">explorer</span><span class="p">.</span><span class="nx">vx</span><span class="p">;</span>
  <span class="nx">explorer</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">explorer</span><span class="p">.</span><span class="nx">vy</span><span class="p">;</span>
  <span class="nf">contain</span><span class="p">(</span><span class="nx">explorer</span><span class="p">,</span> <span class="p">{</span> <span class="na">x</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span> <span class="na">y</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="na">width</span><span class="p">:</span> <span class="mi">488</span><span class="p">,</span> <span class="na">height</span><span class="p">:</span> <span class="mi">480</span> <span class="p">});</span>

  <span class="c1">// 在碰撞前设置 exploreHit 为 false</span>
  <span class="kd">let</span> <span class="nx">explorerHit</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="c1">// 移动怪物实体</span>
  <span class="nx">blobs</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="nf">function </span><span class="p">(</span><span class="nx">blob</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 移动怪物</span>
    <span class="nx">blob</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">blob</span><span class="p">.</span><span class="nx">vy</span><span class="p">;</span>
    <span class="c1">// 检查怪物的屏幕边界</span>
    <span class="kd">let</span> <span class="nx">blobHitsWall</span> <span class="o">=</span> <span class="nf">contain</span><span class="p">(</span><span class="nx">blob</span><span class="p">,</span> <span class="p">{</span> <span class="na">x</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span> <span class="na">y</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="na">width</span><span class="p">:</span> <span class="mi">488</span><span class="p">,</span> <span class="na">height</span><span class="p">:</span> <span class="mi">488</span> <span class="p">});</span>
    <span class="c1">// 如果实体碰到上下边缘，改变它的方向</span>
    <span class="k">if </span><span class="p">([</span><span class="dl">"</span><span class="s2">top</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">bottom</span><span class="dl">"</span><span class="p">].</span><span class="nf">indexOf</span><span class="p">(</span><span class="nx">blobHitsWall</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">blob</span><span class="p">.</span><span class="nx">vy</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// 碰撞测试，如果碰到归爱武，设置 exploreHit 为 true</span>
    <span class="k">if </span><span class="p">(</span><span class="nf">hitTestRectangle</span><span class="p">(</span><span class="nx">explorer</span><span class="p">,</span> <span class="nx">blob</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">explorerHit</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="c1">// 检查探索者与怪物的碰撞</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">explorerHit</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 设置探索者半透明</span>
    <span class="nx">explorer</span><span class="p">.</span><span class="nx">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="c1">// 减少血条长度</span>
    <span class="nx">healthBar</span><span class="p">.</span><span class="nx">outer</span><span class="p">.</span><span class="nx">width</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// 设置探索者不透明</span>
    <span class="nx">explorer</span><span class="p">.</span><span class="nx">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// 检查探索者与宝藏的碰撞，携带宝藏移动</span>
  <span class="k">if </span><span class="p">(</span><span class="nf">hitTestRectangle</span><span class="p">(</span><span class="nx">explorer</span><span class="p">,</span> <span class="nx">treasure</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">treasure</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">explorer</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="mi">8</span><span class="p">;</span>
    <span class="nx">treasure</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">explorer</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="mi">8</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// 检查宝藏与门的碰撞，赢得游戏</span>
  <span class="k">if </span><span class="p">(</span><span class="nf">hitTestRectangle</span><span class="p">(</span><span class="nx">treasure</span><span class="p">,</span> <span class="nx">door</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">state</span> <span class="o">=</span> <span class="nx">end</span><span class="p">;</span>
    <span class="nx">message</span><span class="p">.</span><span class="nx">text</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">You won!</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// 游戏失败，将 state 函数设为 end</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">healthBar</span><span class="p">.</span><span class="nx">outer</span><span class="p">.</span><span class="nx">width</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">state</span> <span class="o">=</span> <span class="nx">end</span><span class="p">;</span>
    <span class="nx">message</span><span class="p">.</span><span class="nx">text</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">You lost!</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 游戏结束</span>
<span class="kd">function</span> <span class="nf">end</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">gameScene</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">gameOverScene</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// The game's helper functions:</span>
<span class="c1">// `keyboard`, `hitTestRectangle`, `contain` and `randomInt`</span>
<span class="kd">function</span> <span class="nf">keyboard</span><span class="p">(</span><span class="nx">keyCode</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">key</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="nx">key</span><span class="p">.</span><span class="nx">code</span> <span class="o">=</span> <span class="nx">keyCode</span><span class="p">;</span>
  <span class="nx">key</span><span class="p">.</span><span class="nx">isDown</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">key</span><span class="p">.</span><span class="nx">isUp</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">key</span><span class="p">.</span><span class="nx">press</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
  <span class="nx">key</span><span class="p">.</span><span class="nx">release</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
  <span class="nx">key</span><span class="p">.</span><span class="nx">downHandler</span> <span class="o">=</span> <span class="nf">function </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">===</span> <span class="nx">key</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">key</span><span class="p">.</span><span class="nx">isUp</span> <span class="o">&amp;&amp;</span> <span class="nx">key</span><span class="p">.</span><span class="nx">press</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">key</span><span class="p">.</span><span class="nf">press</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="nx">key</span><span class="p">.</span><span class="nx">isDown</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">key</span><span class="p">.</span><span class="nx">isUp</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">event</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>
  <span class="p">};</span>
  <span class="nx">key</span><span class="p">.</span><span class="nx">upHandler</span> <span class="o">=</span> <span class="nf">function </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">===</span> <span class="nx">key</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">key</span><span class="p">.</span><span class="nx">isDown</span> <span class="o">&amp;&amp;</span> <span class="nx">key</span><span class="p">.</span><span class="nx">release</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">key</span><span class="p">.</span><span class="nf">release</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="nx">key</span><span class="p">.</span><span class="nx">isDown</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="nx">key</span><span class="p">.</span><span class="nx">isUp</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">event</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>
  <span class="p">};</span>
  <span class="nb">window</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">keydown</span><span class="dl">"</span><span class="p">,</span> <span class="nx">key</span><span class="p">.</span><span class="nx">downHandler</span><span class="p">.</span><span class="nf">bind</span><span class="p">(</span><span class="nx">key</span><span class="p">),</span> <span class="kc">false</span><span class="p">);</span>
  <span class="nb">window</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">keyup</span><span class="dl">"</span><span class="p">,</span> <span class="nx">key</span><span class="p">.</span><span class="nx">upHandler</span><span class="p">.</span><span class="nf">bind</span><span class="p">(</span><span class="nx">key</span><span class="p">),</span> <span class="kc">false</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">key</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">hitTestRectangle</span><span class="p">(</span><span class="nx">r1</span><span class="p">,</span> <span class="nx">r2</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 定义我们需要计算的变量</span>
  <span class="kd">let</span> <span class="nx">hit</span><span class="p">,</span> <span class="nx">combinedHalfWidths</span><span class="p">,</span> <span class="nx">combinedHalfHeights</span><span class="p">,</span> <span class="nx">vx</span><span class="p">,</span> <span class="nx">vy</span><span class="p">;</span>
  <span class="c1">// hit决定是否有碰撞</span>
  <span class="nx">hit</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="c1">// 找到每个精灵的中心点</span>
  <span class="nx">r1</span><span class="p">.</span><span class="nx">centerX</span> <span class="o">=</span> <span class="nx">r1</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">r1</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
  <span class="nx">r1</span><span class="p">.</span><span class="nx">centerY</span> <span class="o">=</span> <span class="nx">r1</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">r1</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
  <span class="nx">r2</span><span class="p">.</span><span class="nx">centerX</span> <span class="o">=</span> <span class="nx">r2</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">r2</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
  <span class="nx">r2</span><span class="p">.</span><span class="nx">centerY</span> <span class="o">=</span> <span class="nx">r2</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">r2</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

  <span class="c1">// 找到每个精灵的一半宽度和一半高度</span>
  <span class="nx">r1</span><span class="p">.</span><span class="nx">halfWidth</span> <span class="o">=</span> <span class="nx">r1</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
  <span class="nx">r1</span><span class="p">.</span><span class="nx">halfHeight</span> <span class="o">=</span> <span class="nx">r1</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
  <span class="nx">r2</span><span class="p">.</span><span class="nx">halfWidth</span> <span class="o">=</span> <span class="nx">r2</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
  <span class="nx">r2</span><span class="p">.</span><span class="nx">halfHeight</span> <span class="o">=</span> <span class="nx">r2</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
  <span class="c1">// 计算精灵之间的向量距离</span>
  <span class="nx">vx</span> <span class="o">=</span> <span class="nx">r1</span><span class="p">.</span><span class="nx">centerX</span> <span class="o">-</span> <span class="nx">r2</span><span class="p">.</span><span class="nx">centerX</span><span class="p">;</span>
  <span class="nx">vy</span> <span class="o">=</span> <span class="nx">r1</span><span class="p">.</span><span class="nx">centerY</span> <span class="o">-</span> <span class="nx">r2</span><span class="p">.</span><span class="nx">centerY</span><span class="p">;</span>
  <span class="c1">// 计算出两个精灵的的一半宽度和一半高度的和</span>
  <span class="nx">combinedHalfWidths</span> <span class="o">=</span> <span class="nx">r1</span><span class="p">.</span><span class="nx">halfWidth</span> <span class="o">+</span> <span class="nx">r2</span><span class="p">.</span><span class="nx">halfWidth</span><span class="p">;</span>
  <span class="nx">combinedHalfHeights</span> <span class="o">=</span> <span class="nx">r1</span><span class="p">.</span><span class="nx">halfHeight</span> <span class="o">+</span> <span class="nx">r2</span><span class="p">.</span><span class="nx">halfHeight</span><span class="p">;</span>
  <span class="c1">// 检测 x 轴的碰撞</span>
  <span class="k">if </span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="nx">vx</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">combinedHalfWidths</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 碰撞可能发生，检查 y 轴碰撞</span>
    <span class="k">if </span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="nx">vy</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">combinedHalfHeights</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">//确实有碰撞发生</span>
      <span class="nx">hit</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// 在 y 轴没有碰撞</span>
      <span class="nx">hit</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// 在x轴没有碰撞</span>
    <span class="nx">hit</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// `hit` 返回 `true` 或者 `false`</span>
  <span class="k">return</span> <span class="nx">hit</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">contain</span><span class="p">(</span><span class="nx">sprite</span><span class="p">,</span> <span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">collision</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
  <span class="c1">// Left</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">container</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">sprite</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
    <span class="nx">collision</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">left</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Top</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">container</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">sprite</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
    <span class="nx">collision</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">top</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Right</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">sprite</span><span class="p">.</span><span class="nx">width</span> <span class="o">&gt;</span> <span class="nx">container</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">sprite</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">sprite</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
    <span class="nx">collision</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">right</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Bottom</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">sprite</span><span class="p">.</span><span class="nx">height</span> <span class="o">&gt;</span> <span class="nx">container</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">sprite</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">sprite</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
    <span class="nx">collision</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">bottom</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// 返回 collision 结果</span>
  <span class="k">return</span> <span class="nx">collision</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">randomInt</span><span class="p">(</span><span class="nx">min</span><span class="p">,</span> <span class="nx">max</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="nx">max</span> <span class="o">-</span> <span class="nx">min</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="nx">min</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Pixi的类继承体系</span>
<span class="c1">// DisplayObject &gt; Container &gt; Sprite</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/2017/" class="post-tag no-text-decoration" >2017</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/2018/">2018</a> <a class="post-tag" href="/tags/2017/">2017</a> <a class="post-tag" href="/tags/2019/">2019</a> <a class="post-tag" href="/tags/2020/">2020</a> <a class="post-tag" href="/tags/2021/">2021</a> <a class="post-tag" href="/tags/2016/">2016</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E5%89%8D%E5%90%8E%E7%AB%AF%E8%81%94%E8%B0%83%E6%B5%81%E7%A8%8B/"><div class="card-body"> <span class="timeago small" > Apr 1, 2017 <i class="unloaded">2017-04-01T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>微信支付前后端联调流程</h3><div class="text-muted small"><p> 微信支付的前后端联调挺多坑的，这里记录一下。 1、后台调用微信接口拿到 access_token # 请求方式 https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=xxxx&amp;secret=xxxxx # 请求结果 {"access_token":"7iBVY8GoBbGp...</p></div></div></a></div><div class="card"> <a href="/posts/%E5%89%8D%E7%AB%AFMOCK%E6%95%B0%E6%8D%AE/"><div class="card-body"> <span class="timeago small" > May 20, 2017 <i class="unloaded">2017-05-20T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>前端MOCK数据</h3><div class="text-muted small"><p> 前端 Mock 数据最佳实践。 // 文档：https://github.com/nuysoft/Mock/wiki // 后台定义的数据格式 let raw = { data: { eid: 27149, // 试卷ID title: "", // 试卷标题 intro: "", // 试卷介绍 imgs: "", // 试卷介绍用的图片 c...</p></div></div></a></div><div class="card"> <a href="/posts/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E8%BD%AF%E9%94%AE%E7%9B%98%E4%B8%8E%E5%AE%9A%E4%BD%8D%E5%B8%83%E5%B1%80/"><div class="card-body"> <span class="timeago small" > Jun 16, 2017 <i class="unloaded">2017-06-16T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>移动端软键盘与定位布局</h3><div class="text-muted small"><p> 虽然第一份工作大部分时间是做移动端，主要用的是 flex 和 rem 布局，到后期放弃 rem 了，发现大屏手机显示更多内容的效果更好。以前也遇到过软键盘影响定位布局的问题，都是拿来老板手机同款的测试机，定位出问题就流水布局吧，各种投机倒把把当前需求完成就完事了。立个 flag，遇到问题，不稳稳的解决不罢休。 小键盘影响布局 最近在安卓手机上遇到个现象，软键盘弹出的时候，把整个背景都顶上...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/%E5%89%8D%E7%AB%AF%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B8%8E%E4%B8%8A%E4%BC%A0/" class="btn btn-outline-primary" prompt="Older"><p>前端本地文件操作与上传</p></a> <a href="/posts/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AALazy-Load/" class="btn btn-outline-primary" prompt="Newer"><p>实现一个Lazy-Load</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/ringcrl">chenng</a>.<p class="mb-0"> <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener"> 粤ICP备18131461号 </a></p></p></div><div class="footer-right"></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/2018/">2018</a> <a class="post-tag" href="/tags/2017/">2017</a> <a class="post-tag" href="/tags/2019/">2019</a> <a class="post-tag" href="/tags/2020/">2020</a> <a class="post-tag" href="/tags/2021/">2021</a> <a class="post-tag" href="/tags/2016/">2016</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="chenng.cn{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
