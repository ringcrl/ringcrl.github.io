<!DOCTYPE html><html lang="zh-CN" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="实现自定义parsefloat" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="layout: post title: 实现自定义parseFloat tags: [‘2019’] —" /><meta property="og:description" content="layout: post title: 实现自定义parseFloat tags: [‘2019’] —" /><link rel="canonical" href="chenng.cn/posts/%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89parseFloat/" /><meta property="og:url" content="chenng.cn/posts/%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89parseFloat/" /><meta property="og:site_name" content="Chenng’s Home" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-03-26T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="实现自定义parsefloat" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2019-03-26T00:00:00+08:00","datePublished":"2019-03-26T00:00:00+08:00","description":"layout: post title: 实现自定义parseFloat tags: [‘2019’] —","headline":"实现自定义parsefloat","mainEntityOfPage":{"@type":"WebPage","@id":"chenng.cn/posts/%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89parseFloat/"},"url":"chenng.cn/posts/%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89parseFloat/"}</script><title>实现自定义parsefloat | Chenng's Home</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Chenng's Home"><meta name="application-name" content="Chenng's Home"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://cdn-1257430323.cos.ap-guangzhou.myqcloud.com/assets/imgs/20210506201457_0026033cb6769057453d0142751005ae.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Chenng's Home</a></div><div class="site-subtitle font-italic"></div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/ringcrl" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['ringcrl','foxmail.com'].join('@')" aria-label="email" class="order-4" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-5" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>实现自定义parsefloat</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>实现自定义parsefloat</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> chenng </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Mar 26, 2019, 12:00 AM +0800" prep="on" > Mar 26, 2019 <i class="unloaded">2019-03-26T00:00:00+08:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="710 words">3 min</span></div></div><div class="post-content"><hr /><p>layout: post title: 实现自定义parseFloat tags: [‘2019’] —</p><p>一个很不常见的需求</p><ul><li>支持超出 17 位的数字（Number.MAX_SAFE_INTEGER）的展示<li>大数不转为科学计数法<li>各种正负号、000、科学计数法输入、数字加字符、字符加数字的 edge case 处理<li>全部使用正则处理，待进行 Benchmark 后才能确定能否用于生产<li>完全基于 TDD 开发</ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://cdn-1257430323.cos.ap-guangzhou.myqcloud.com/assets/imgs/20210505081213_9e5b2a68a79ef5feea30161a1d58c05b.png" alt="01.png" /></p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
</pre><td class="rouge-code"><pre><span class="cm">/**
 * 测试用例，待完善
 */</span>
<span class="kd">const</span> <span class="nx">testCase</span> <span class="o">=</span> <span class="p">[</span>
  <span class="dl">'</span><span class="s1">-0.123</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">-.123</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">--123</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">44444444444444444444</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">-5555555555555555555</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">.1234567891234567891</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">12345678910</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">12345678910123456789100</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">0.123456789</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">123456789123456789123456789123456789123456789123456789</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">5e+3</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">5e-5</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">5e55</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">123456felix</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">123456felix123456yang123456</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">felix123456</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">felix123456yang123456is123456poor</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">+123</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">123 123</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">123.123.123</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">0000123</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">-0000123</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">-0000.123</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">+0000123</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">+0000.123</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">-.123</span><span class="dl">'</span><span class="p">,</span>
<span class="p">];</span>
<span class="kd">const</span> <span class="nx">expect</span> <span class="o">=</span> <span class="p">[</span>
  <span class="dl">'</span><span class="s1">-0.123</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">-0.123</span><span class="dl">'</span><span class="p">,</span>
  <span class="kc">undefined</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">44444444444444444444</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">-5555555555555555555</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">0.1234567891234567891</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">12345678910</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">12345678910123456789100</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">0.123456789</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">123456789123456789123456789123456789123456789123456789</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">5000</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">0.00005</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">5e+55</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">123456</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">123456</span><span class="dl">'</span><span class="p">,</span>
  <span class="kc">undefined</span><span class="p">,</span>
  <span class="kc">undefined</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">123</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">123</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">123.123</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">123</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">-123</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">-0.123</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">123</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">0.123</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">-0.123</span><span class="dl">'</span><span class="p">,</span>
<span class="p">];</span>

<span class="kd">function</span> <span class="nf">test</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">failIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">successCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">failResult</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">passed</span> <span class="o">=</span> <span class="nx">testCase</span><span class="p">.</span><span class="nf">every</span><span class="p">((</span><span class="nx">item</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nf">numberHandler</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">===</span> <span class="nx">expect</span><span class="p">[</span><span class="nx">index</span><span class="p">])</span> <span class="p">{</span>
      <span class="nx">successCount</span><span class="o">++</span><span class="p">;</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">failIndex</span>  <span class="o">=</span> <span class="nx">index</span><span class="p">;</span>
    <span class="nx">failResult</span> <span class="o">=</span> <span class="nf">numberHandler</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">});</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">passed</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`测试通过，通过 </span><span class="p">${</span><span class="nx">successCount</span><span class="p">}</span><span class="s2"> 条测试用例`</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`
      第 </span><span class="p">${</span><span class="nx">failIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span><span class="s2"> 条用例失败
      输入：</span><span class="p">${</span><span class="nx">testCase</span><span class="p">[</span><span class="nx">failIndex</span><span class="p">]}</span><span class="s2">
      预期：</span><span class="p">${</span><span class="nx">expect</span><span class="p">[</span><span class="nx">failIndex</span><span class="p">]}</span><span class="s2">
      结果：</span><span class="p">${</span><span class="nx">failResult</span><span class="p">}</span><span class="s2">
    `</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nf">test</span><span class="p">();</span>

<span class="cm">/**
 * 
 * @param {string} numStr 
 */</span>
<span class="kd">function</span> <span class="nf">numberHandler</span><span class="p">(</span><span class="nx">numStr</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 如果不理解下面为什么这样处理</span>
  <span class="c1">// 可以尝试去掉，看看哪个用例过不了</span>

  <span class="k">if </span><span class="p">(</span><span class="nf">isInvalid</span><span class="p">(</span><span class="nx">numStr</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if </span><span class="p">(</span><span class="nf">isPureNumber</span><span class="p">(</span><span class="nx">numStr</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">numStr</span><span class="p">.</span><span class="nf">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">-</span><span class="dl">'</span> <span class="p">?</span>
      <span class="nx">numStr</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sr">/^-0+/</span><span class="p">,</span> <span class="dl">'</span><span class="s1">-</span><span class="dl">'</span><span class="p">)</span> <span class="p">:</span>
      <span class="nx">numStr</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sr">/^0+/</span><span class="p">,</span> <span class="dl">''</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">if </span><span class="p">(</span><span class="nf">isPlusNumber</span><span class="p">(</span><span class="nx">numStr</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">numStr</span><span class="p">.</span><span class="nf">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="sr">/^0+/</span><span class="p">,</span> <span class="dl">''</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">if </span><span class="p">(</span><span class="nf">isStartWithDot</span><span class="p">(</span><span class="nx">numStr</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">numStr</span><span class="p">.</span><span class="nf">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">-</span><span class="dl">'</span> <span class="p">?</span>
      <span class="s2">`-0</span><span class="p">${</span><span class="nx">numStr</span><span class="p">.</span><span class="nf">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">)}</span><span class="s2">`</span><span class="p">:</span>
      <span class="s2">`0</span><span class="p">${</span><span class="nx">numStr</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if </span><span class="p">(</span><span class="nf">isDecimal</span><span class="p">(</span><span class="nx">numStr</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">numStr</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sr">/^</span><span class="se">([</span><span class="sr">+-</span><span class="se">]?)(</span><span class="sr">0+</span><span class="se">)(\.\d</span><span class="sr">+</span><span class="se">)</span><span class="sr">/</span><span class="p">,</span> <span class="p">(</span><span class="nx">matcher</span><span class="p">,</span> <span class="nx">flag</span><span class="p">,</span> <span class="nx">prev</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">flag</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">+</span><span class="dl">'</span> <span class="p">?</span>
        <span class="s2">`</span><span class="p">${</span><span class="nx">prev</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sr">/0+/</span><span class="p">,</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">)}${</span><span class="nx">next</span><span class="p">}</span><span class="s2">`</span> <span class="p">:</span>
        <span class="s2">`</span><span class="p">${</span><span class="nx">flag</span><span class="p">}${</span><span class="nx">prev</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sr">/0+/</span><span class="p">,</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">)}${</span><span class="nx">next</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="k">if </span><span class="p">(</span><span class="nf">isScientificNotation</span><span class="p">(</span><span class="nx">numStr</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nf">parseFloat</span><span class="p">(</span><span class="nx">numStr</span><span class="p">)</span> <span class="o">+</span> <span class="dl">''</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if </span><span class="p">(</span><span class="nf">isNumberPlusNotNumber</span><span class="p">(</span><span class="nx">numStr</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">numStr</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="sr">/^</span><span class="se">(\d</span><span class="sr">+</span><span class="se">)</span><span class="sr">/g</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="k">if </span><span class="p">(</span><span class="nf">isMultiDots</span><span class="p">(</span><span class="nx">numStr</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">numStr</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="sr">/^</span><span class="se">(\d</span><span class="sr">+</span><span class="se">\.\d</span><span class="sr">+</span><span class="se">)</span><span class="sr">/g</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**
 * 不存在数字
 */</span>
<span class="kd">function</span> <span class="nf">isInvalid</span><span class="p">(</span><span class="nx">numStr</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">!</span><span class="sr">/</span><span class="se">\d</span><span class="sr">/</span><span class="p">.</span><span class="nf">test</span><span class="p">(</span><span class="nx">numStr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**
 * 纯数字，包含负数
 */</span>
<span class="kd">function</span> <span class="nf">isPureNumber</span><span class="p">(</span><span class="nx">numStr</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="sr">/^-</span><span class="se">?\d</span><span class="sr">+$/</span><span class="p">.</span><span class="nf">test</span><span class="p">(</span><span class="nx">numStr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**
 * 数字前面带有 + 号
 */</span>
<span class="kd">function</span> <span class="nf">isPlusNumber</span><span class="p">(</span><span class="nx">numStr</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="sr">/^</span><span class="se">\+\d</span><span class="sr">+$/</span><span class="p">.</span><span class="nf">test</span><span class="p">(</span><span class="nx">numStr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**
 * 以 . 开头
 */</span>
<span class="kd">function</span> <span class="nf">isStartWithDot</span><span class="p">(</span><span class="nx">numStr</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="sr">/^</span><span class="se">[</span><span class="sr">+-</span><span class="se">]?\.\d</span><span class="sr">+$/</span><span class="p">.</span><span class="nf">test</span><span class="p">(</span><span class="nx">numStr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**
 * 格式正确的小数
 */</span>
<span class="kd">function</span> <span class="nf">isDecimal</span><span class="p">(</span><span class="nx">numStr</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="sr">/^</span><span class="se">[</span><span class="sr">+-</span><span class="se">]?\d</span><span class="sr">+</span><span class="se">\.\d</span><span class="sr">+$/</span><span class="p">.</span><span class="nf">test</span><span class="p">(</span><span class="nx">numStr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**
 * 输入科学计数法
 */</span>
<span class="kd">function</span> <span class="nf">isScientificNotation</span><span class="p">(</span><span class="nx">numStr</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="sr">/^</span><span class="se">[</span><span class="sr">+-</span><span class="se">]?\d</span><span class="sr">+e</span><span class="se">[</span><span class="sr">+-</span><span class="se">]?\d</span><span class="sr">+$/</span><span class="p">.</span><span class="nf">test</span><span class="p">(</span><span class="nx">numStr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**
 * 输入【数字+非数字的情况】
 */</span>
<span class="kd">function</span> <span class="nf">isNumberPlusNotNumber</span><span class="p">(</span><span class="nx">numStr</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="sr">/^</span><span class="se">\d</span><span class="sr">+</span><span class="se">[^\d\.]</span><span class="sr">+/</span><span class="p">.</span><span class="nf">test</span><span class="p">(</span><span class="nx">numStr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**
 * 多个 . 的情况
 */</span>
<span class="kd">function</span> <span class="nf">isMultiDots</span><span class="p">(</span><span class="nx">numStr</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="sr">/^</span><span class="se">(\d</span><span class="sr">+</span><span class="se">\.\d</span><span class="sr">+</span><span class="se">)</span><span class="sr">/</span><span class="p">.</span><span class="nf">test</span><span class="p">(</span><span class="nx">numStr</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/2018/">2018</a> <a class="post-tag" href="/tags/2017/">2017</a> <a class="post-tag" href="/tags/2019/">2019</a> <a class="post-tag" href="/tags/2020/">2020</a> <a class="post-tag" href="/tags/2021/">2021</a> <a class="post-tag" href="/tags/2016/">2016</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%87%AA%E5%8A%A8%E5%8C%96%E8%A7%86%E9%A2%91%E6%AF%94%E5%AF%B9%E6%96%B9%E6%A1%88/"><div class="card-body"> <span class="timeago small" > May 6, 2021 <i class="unloaded">2021-05-06T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>canvas像素对比测试用例</h3><div class="text-muted small"><p> 最近在做服务端 canvas-webgl 渲染，探索下怎么通过自动化的方案来保证渲染效果。 探索背景 网络上对 Canvas 的渲染测试用例方案归纳有三种： 方案一：Node 记录 Canvas 的 API 操作记录，验证执行，例如：jest-mock-canvas 方案二：真实浏览器渲染比对，例如 cypress 方案三：学习 Three.js 的 e2e 测试用例，使...</p></div></div></a></div><div class="card"> <a href="/posts/PS-AE-Sketch/"><div class="card-body"> <span class="timeago small" > Apr 30, 2021 <i class="unloaded">2021-04-30T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>PS-AE-Sketch</h3><div class="text-muted small"><p> PS 面板 主菜单【窗口】下开启的窗户，必备的是【属性】、【信息】、【图层】 选择图层 【cmd + 左键】 =&gt; 选择图层 【option + 滚轮】 =&gt; 放大缩小图像 属性面板 选择图层之后，可以再属性面板看到： 文本的字体大小和颜色 形状的填充色和圆角 智能对象的宽高 信息面板 有时候在【属性面板】不能看到图层的宽高信息，可以...</p></div></div></a></div><div class="card"> <a href="/posts/WebCodecs%E5%AF%B9%E9%9F%B3%E8%A7%86%E9%A2%91%E8%BF%9B%E8%A1%8C%E7%BC%96%E7%A0%81%E8%A7%A3%E7%A0%81/"><div class="card-body"> <span class="timeago small" > Oct 19, 2020 <i class="unloaded">2020-10-19T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>WebCodecs对音视频进行编码解码</h3><div class="text-muted small"><p> WebCodecs 草案：https://wicg.github.io/web-codecs/ Github：https://github.com/WICG/web-codecs 允许 Web 应用程序对音频和视频进行编码和解码的 API 在 Chrome &gt;= 86 的版本进行体验 Chrome地址栏输入：chrome://flags/#enable-exp...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/%E5%A4%A7%E5%9E%8BxmlStr%E7%9A%84DOMParser/" class="btn btn-outline-primary" prompt="Older"><p>大型xmlStr的DOMParser</p></a> <a href="/posts/React%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-Jest&enzyme/" class="btn btn-outline-primary" prompt="Newer"><p>React单元测试-Jest&enzyme</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/ringcrl">chenng</a>.<p class="mb-0"> <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener"> 粤ICP备18131461号 </a></p></p></div><div class="footer-right"></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/2018/">2018</a> <a class="post-tag" href="/tags/2017/">2017</a> <a class="post-tag" href="/tags/2019/">2019</a> <a class="post-tag" href="/tags/2020/">2020</a> <a class="post-tag" href="/tags/2021/">2021</a> <a class="post-tag" href="/tags/2016/">2016</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="chenng.cn{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
